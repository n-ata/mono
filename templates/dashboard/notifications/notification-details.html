{% extends 'dashboard/base.html' %}
{% load static %}
{% load utils%}
{% block title %}{{ title }}{% endblock title %}
{% block content %}
<link href="{% static 'admin/assets/plugins/custom/cropper/cropper.bundle.css' %}" rel="stylesheet" type="text/css" />
	<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
		<!--begin::Content wrapper-->
		<div class="d-flex flex-column flex-column-fluid">
			<!--begin::Toolbar-->
			<div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
				<!--begin::Toolbar container-->
				<div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
					<!--begin::Page title-->
					<div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
						<!--begin::Title-->
						<h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">Create Notification</h1>
						<!--end::Title-->
						<!--begin::Breadcrumb-->
						<ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
							<!--begin::Item-->
							<li class="breadcrumb-item text-muted">
								<a href="{% url 'dashboard:users' %}" class="text-muted text-hover-primary">Home</a>
							</li>
							<!--end::Item-->
							<!--begin::Item-->
							<li class="breadcrumb-item">
								<span class="bullet bg-gray-400 w-5px h-2px"></span>
							</li>
							<!--end::Item-->
							<!--begin::Item-->
							<li class="breadcrumb-item text-muted">create-notification</li>
							<!--end::Item-->
						</ul>
						<!--end::Breadcrumb-->
					</div>
					<!--end::Page title-->
				</div>
				<!--end::Toolbar container-->
			</div>
			<!--end::Toolbar-->
			<!--begin::Content-->
			<div id="kt_app_content" class="app-content flex-column-fluid">
				<!--begin::Content container-->
				<div id="kt_app_content_container" class="app-container container-xxl">
					<!--begin::Card-->
					<div class="card">
						<!--begin::Card body-->
						<div class="card-body py-4">
							<form class="form" action="{% url 'dashboard:create-notification' %}" id="notification-detail-form">
								<!--begin::Step 1-->
								{% csrf_token %}
								<div class="d-flex flex-column me-n7 pe-7">
									<div class="row mb-7">
										<div class="col-12">
											<div class="position-relative mb-3">
												<label class="form-label fs-6 fw-semibold">Title:</label>
												<input type="text" name="title" class="form-control" placeholder="Title"/>
											</div>
										</div>
									</div>
									<div class="row mb-7">
										<div class="col-12">
											<div class="position-relative mb-3">
												<label class="form-label fs-6 fw-semibold">Body:</label>
												<textarea  class="form-control me-10" name="body" ></textarea>
											</div>
										</div>
									</div>
								</div>
								<div class="d-flex justify-content-between pt-15">
									<a href="{% url 'dashboard:notifications' %}" class="btn btn-info" >
										<span class="indicator-label">Back</span>
									</a>
									<button type="submit" class="btn btn-primary" >
										<span class="indicator-label">Save</span>
										<span class="indicator-progress">Please wait...
										<span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
									</button>
									<button type="reset" class="btn btn-secondary d-none" id="reset-form">Cancel</button>
								</div>
								
								<!--begin::Repeater-->
								
								<!--end::Repeater-->
							</form>

							
						</div>
						<!--end::Card body-->
					</div>
					<!--end::Card-->
				</div>
				<!--end::Content container-->
			</div>
			<!--end::Content-->
		</div>
		<!--end::Content wrapper-->
		<!--begin::Footer-->
		<div id="kt_app_footer" class="app-footer">
			<!--begin::Footer container-->
			<div class="app-container container-fluid d-flex flex-column flex-md-row flex-center flex-md-stack py-3">
				<!--begin::Copyright-->
				<div class="text-dark order-2 order-md-1">
					<span class="text-muted fw-semibold me-1">2022Â©</span>
					<a href="https://azico.team" target="_blank" class="text-gray-800 text-hover-primary">AZICO TEAM</a>
				</div>
				<!--end::Copyright-->
			</div>
			<!--end::Footer container-->
		</div>
		<!--end::Footer-->
	</div>
	<!--CKEditor Build Bundles:: Only include the relevant bundles accordingly-->
	
{% endblock content %}


{% block script %}
	<script>
		
		function getCookie(cname) {
			let name = cname + "=";
			let decodedCookie = decodeURIComponent(document.cookie);
			let ca = decodedCookie.split(';');
			for(let i = 0; i <ca.length; i++) {
			  let c = ca[i];
			  while (c.charAt(0) == ' ') {
				c = c.substring(1);
			  }
			  if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			  }
			}
			return "";
		}

		document.addEventListener("DOMContentLoaded", function(event) {
			$("#notification-detail-form").submit(function(e) {
				e.preventDefault(); // avoid to execute the actual submit of the form.
				
				var form = $(this);
				var actionUrl = form.attr('action');
				var formDataOld = new FormData(form[0]);
				
				$.ajax({
					type: "POST",
					url: actionUrl,
					csrfmiddlewaretoken: '{{ csrf_token }}',
					data: formDataOld, // serializes the form's elements.
					beforeSend: function(){
						Swal.fire({
							text: "Creating notification",
							icon: "info",
							buttonsStyling: false,
							showConfirmButton: false,
							allowOutsideClick: false
						});
					},
					success: function(data, status)
					{
						Swal.fire({
							text: "Notification successfully created",
							icon: "success",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn fw-bold btn-primary",
							}
						}).then(function (){
							window.location.replace("{% url 'dashboard:notifications' %}");
						});
						
					},
					error: function(request, status, error){
						Swal.fire({
							text: "Something went wrong!",
							icon: "error",
							buttonsStyling: false,
							confirmButtonText: "Ok, got it!",
							customClass: {
								confirmButton: "btn fw-bold btn-primary",
							}
						});
					},
					cache: false,
					contentType: false,
					processData: false
				});
				
			});
		});

		
		
	</script>
{% endblock %}